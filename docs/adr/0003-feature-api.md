# 0004. Понятие фичи и единая точка взаимодействия (`XxxFeature`), структура API-модулей

Дата: 13.10.2025

## Контекст

Требуется единый и предсказуемый способ обращения к возможностям фичи и стабильные контракты на уровне домена
приложения.

## Решение

Фича — доменная сущность уровня приложения, имеющая **одну точку входа** `interface XxxFeature` в модуле
`:feature:<name>:api`.  
Все публичные сущности доменного слоя фичи также размещаются в её `api` (в пакете `entity`).  
Реализация, интеракторы и репозитории фичи находятся внутри `impl`.

### Вопрос-ответ

**Почему одна точка входа?**  
Чтобы обеспечить принцип Single Responsibility, унифицированный доступ и простую навигацию.

**Это не делает фичу монолитом?**  
Нет, внутри `impl` остаётся чистая архитектура с разделением по слоям на уровне пакетов `/domain` `/data` `/ui`.

**Можно ли создать несколько интерфейсов в api?**  
Нет. Каждая фича должна иметь только один основной интерфейс `XxxFeature`.

**Можно ли переиспользовать модели из других `api`?**  
Нет. Общие модели — в `:feature:shared-api`; специфичные — дублируются для обеспечения изоляции.

**Где держать базовые типы (`UserId`, `Money`)?**  
В `:feature:shared-api`. Подробнее см. ADR [0007](0007-shared-api-isolation.md).

### Конвенции

- Имя интерфейса: `XxxFeature`
- Модуль: `:feature:<name>:api`
- Пакет: `<package>.feature.<feature.name>`
- В API только экспортируемые контракты и модели, без зависимостей на `impl`

*Подробнее см. ADR [0007](0007-feature-naming-conventions.md) - Конвенции именования feature-модулей*

### Структура API пакета

```
feature/
└── <name>/
    └── api/                       # API-модуль :feature:<name>:api
        ├── XxxFeature.kt          # Основной интерфейс фичи
        └── entity/                # Публичные сущности доменного слоя
            ├── XxxEvent.kt        # Пример: События
            ├── XxxState.kt        # Пример: Состояния и статусы
            └── XxxData.kt         # Пример: data class
```

**Правила размещения:**

- Основной интерфейс фичи размещаются в корне пакета
- Все публичные сущности размещаются в пакете `/entity` внутри `api`-модуля
- Никаких внутренних деталей реализации

**Рекомендации по именованию сущностей:**
Именование сущностей жёстко не регламентируется, но рекомендуется называть с префиксом имени фичи для избежания конфликтов и улучшения читаемости (например: `PaymentEvent`, `AuthState`, `UserData`).

## Последствия

**Положительные:**

- Чёткие границы и предсказуемость архитектуры
- Самодокументирующиеся зависимости (`*Feature`)
- Упрощение тестирования (моки на уровне фичи)
- Единая точка входа упрощает навигацию по коду

**Отрицательные:**

- Требуется дисциплина при поддержании стабильности API
- Ограничение на количество публичных интерфейсов фичи
