# 0003. Разделение Gradle-фич-модулей на `api` и `impl`

## Контекст

Необходимо стандартизировать подход к организации **Gradle-feature-модулей**.  
Ранее фичи могли реализовываться по-разному: иногда в одном Gradle-модуле без чёткого разделения на контракт (`api`) и
реализацию (`impl`), иногда с `api` и отдельными реализациями под разные платформы (tv/handheld).
Это приводило к циклическим зависимостям, размытию границ, трудностям при тестировании и подмене реализаций.

## Решение

Каждый Gradle-фич-модуль **обязательно** делится на `api` и `impl` модули:

- `:feature:<name>:api` — содержит только публичный контракт фичи и её модели
- `:feature:<name>:impl` — содержит реализацию, внутренние классы и DI-биндинги

**Ключевой принцип:** Связывание интерфейса и реализации выполняется в `app`-модуле через DI.

### Правила зависимостей

**Разрешено:**

- `feature:xxx:impl → feature:yyy:api`
- `feature:xxx:impl → feature:shared-api`
- `feature:xxx:api → feature:shared-api`

**Запрещено:**

- `feature:xxx:api → feature:yyy:api` (кроме `shared-api`)
- `feature:xxx:impl → feature:yyy:impl`

### Рекомендации для `api`-модулей

Для `api`-модулей рекомендуется использовать «чистые» JVM-модули не содержащие ресурсов, платформенных зависимостей и
иных избыточных артефактов. Данный подход обеспечивает минимизацию состава зависимостей и сокращение времени сборки.

### Вопрос-ответ

**Зачем делить млдули на `api` и `impl`?**  
Чтобы инкапсулировать реализацию, исключить циклические зависимости и упростить тестирование.

**Можно ли `api` зависеть от `api` другой фичи?**  
Нет. В порядке исключения `api` может зависеть только от `:feature:shared-api`.

**От чего может зависеть `impl`?**  
От любых `*:api`-модулей, но не от других `impl`.

**Где происходит связывание `api` и `impl`?**  
В `app`-модуле (DI регистрирует связь `XxxFeature` → `XxxFeatureImpl`).

### Базовый пример структуры

```
feature/
└── payments/
    ├── api/                              # API-модуль :feature:payments:api для платежей
    └── impl/                             # Impl-модуль :feature:payments:impl для платежей
```

## Последствия

**Положительные:**

- Исключены циклические зависимости между модулями
- Чёткое разделение контракта и реализации
- Возможность подмены реализаций для тестирования
- Упрощение навигации по коду (контракты отдельно от реализации)

**Отрицательные:**

- Увеличивается количество Gradle-модулей
- Требуется дисциплина при соблюдении правил зависимостей
